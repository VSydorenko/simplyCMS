

# Повноцінна система управління банерами

## Огляд

Перетворення поточної базової таблиці `banners` у повноцінну систему з підтримкою:
- Завантаження зображень у окремий бакет Storage
- Прив'язки банерів до місць показу (головна, каталог, конкретні розділи)
- Розкладу показу (дати, дні тижня, години)
- Кількох кнопок з посиланнями та `target="_blank"`
- Таймера відображення слайду та налаштувань анімації
- Повноцінної сторінки редагування банера (замість діалогу)

---

## Фаза 1: Оновлення бази даних

### 1.1 Нові колонки таблиці `banners`

| Колонка | Тип | Призначення |
|---|---|---|
| `placement` | `text` | Тип місця: `home`, `catalog`, `section`, `blog`, `global` |
| `section_id` | `uuid (FK -> sections)` | Конкретний розділ (коли placement = section) |
| `buttons` | `jsonb` | Масив кнопок: `[{text, url, target, variant}]` |
| `date_from` | `timestamptz` | Початок періоду показу |
| `date_to` | `timestamptz` | Кінець періоду показу |
| `schedule_days` | `integer[]` | Дні тижня (0=Нд, 1=Пн ... 6=Сб) |
| `schedule_time_from` | `time` | Час початку показу |
| `schedule_time_to` | `time` | Час завершення показу |
| `slide_duration` | `integer` | Час показу слайду в мс (за замовчуванням 5000) |
| `animation_type` | `text` | Тип анімації: `fade`, `slide`, `zoom`, `none` |
| `animation_duration` | `integer` | Тривалість анімації в мс (за замовчуванням 500) |
| `overlay_color` | `text` | Колір оверлею (напр. `rgba(0,0,0,0.4)`) |
| `text_position` | `text` | Позиція тексту: `left`, `center`, `right` |
| `desktop_image_url` | `text` | Окреме зображення для десктопу (опціонально) |
| `mobile_image_url` | `text` | Окреме зображення для мобільної версії (опціонально) |

Старі колонки `button_text` та `link_url` видаляються (мігрують в `buttons`).

### 1.2 Міграція існуючих даних

SQL-міграція перенесе `button_text` + `link_url` у `buttons` jsonb-масив перед видаленням старих колонок.

### 1.3 Storage бакет `banner-images`

Окремий публічний бакет `banner-images` для файлів банерів з RLS-політикою для адмінів.

---

## Фаза 2: Адмін-інтерфейс

### 2.1 Список банерів `/admin/banners`

Оновлений список з відображенням:
- Прев'ю зображення, заголовок, місце показу (бейдж)
- Статус: активний/неактивний + індикатор розкладу (іконка годинника, якщо є обмеження)
- Дати показу (якщо задані)
- Кнопки: Редагувати, Видалити, Тоггл активності
- Drag-and-drop сортування (GripVertical вже є)

### 2.2 Сторінка редагування банера `/admin/banners/:bannerId`

Замість діалогу - повноцінна окрема сторінка з табами або секціями:

**Секція "Основне":**
- Заголовок, підзаголовок
- Завантаження зображення через `ImageUpload` (у бакет `banner-images`)
- Опціонально: окреме зображення для мобільної версії
- Позиція тексту (ліворуч / центр / праворуч)
- Колір оверлею (color picker)

**Секція "Кнопки":**
- Динамічний список кнопок (додати/видалити)
- Для кожної кнопки: текст, URL, варіант (primary/secondary/outline), target (поточна вкладка / нова вкладка `_blank`)

**Секція "Розміщення":**
- Select: Головна / Каталог / Розділ / Блог / Глобально
- Якщо "Розділ" - додатковий Select з вибором конкретного розділу з БД

**Секція "Розклад":**
- Період дат: дата початку + дата закінчення (DatePicker)
- Дні тижня: чекбокси Пн-Нд
- Час показу: від-до (time inputs)

**Секція "Анімація":**
- Тип анімації: Select (Ковзання / Зникання / Збільшення / Без анімації)
- Тривалість анімації: slider (100-2000 мс)
- Час показу слайду: slider (1000-15000 мс)

**Секція "Статус":**
- Перемикач Активний/Неактивний
- Порядок сортування

---

## Фаза 3: Оновлення фронтенд-компонента BannerSlider

### 3.1 Хук `useBanners(placement, sectionId?)`

Хук для завантаження банерів з фільтрацією:
- За `placement`
- За `section_id` (якщо задано)
- За `is_active = true`
- Клієнтська фільтрація за розкладом (дати, дні тижня, години)

### 3.2 Оновлений `BannerSlider`

- Приймає `placement` та `sectionId` як пропси
- Використовує `slide_duration` з кожного банера для автопрокрутки
- Рендерить масив кнопок з `buttons` jsonb
- Підтримує `animation_type`: CSS-класи для fade/slide/zoom
- Використовує `text_position` для позиціонування контенту
- `overlay_color` для оверлею

### 3.3 Інтеграція в сторінки

- `HomePage`: `<BannerSlider placement="home" />`
- `CatalogPage`/`CatalogSectionPage`: `<BannerSlider placement="catalog" />` або `<BannerSlider placement="section" sectionId={...} />`
- Глобальні банери: відображаються на всіх сторінках

---

## Фаза 4: Маршрутизація та навігація

### 4.1 Нові маршрути

- `/admin/banners` - список (існує, оновлюється)
- `/admin/banners/new` - створення нового банера
- `/admin/banners/:bannerId` - редагування банера

### 4.2 Оновлення ThemeRouter

Додати маршрути `banners/new` та `banners/:bannerId` в адмін-секцію.

---

## Порядок реалізації

| Крок | Що робимо |
|---|---|
| 1 | SQL-міграція: нові колонки + бакет `banner-images` + міграція даних |
| 2 | Хук `useBanners` для клієнтського використання |
| 3 | Сторінка `/admin/banners/:bannerId` (BannerEdit) з усіма секціями |
| 4 | Оновлення списку `/admin/banners` (бейджі, індикатори) |
| 5 | Оновлення `BannerSlider` (анімації, кнопки, розклад) |
| 6 | Інтеграція в каталог та інші сторінки |
| 7 | Маршрути в ThemeRouter |

---

## Технічні деталі

- **ImageUpload**: перевикористовуємо існуючий компонент, але вказуємо бакет `banner-images` замість `product-images`. Потрібно параметризувати `bucket` в `ImageUpload`.
- **Buttons jsonb**: формат `[{"text": "Купити", "url": "/catalog", "target": "_self", "variant": "primary"}]`
- **Schedule filtering**: фільтрація за розкладом виконується на клієнті (JS), оскільки залежить від timezone користувача.
- **Анімації**: CSS-класи `banner-fade-in`, `banner-slide-in`, `banner-zoom-in` з `animation-duration` як inline style.
- **Бакет `banner-images`**: публічний, з RLS для запису тільки адмінами.

