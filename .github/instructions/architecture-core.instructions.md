---
applyTo: '**/*'
description: '–ë–∞–∑–æ–≤—ñ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ SimplyCMS'
---

# Architecture Core Rules

## –û—Å–Ω–æ–≤–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

SimplyCMS ‚Äî open-source e-commerce CMS –∑ SSR-first –ø—ñ–¥—Ö–æ–¥–æ–º –¥–ª—è –ø—É–±–ª—ñ—á–Ω–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫. –ü—Ä–æ–µ–∫—Ç —Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è –∑:

- **`app/`** ‚Äî Next.js App Router (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü—ñ—è, —Å—Ç–æ—Ä—ñ–Ω–∫–∏)
- **`packages/simplycms/`** ‚Äî –Ø–¥—Ä–æ CMS (Git Subtree ‚Üí –æ–∫—Ä–µ–º–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π)
- **`themes/`** ‚Äî –õ–æ–∫–∞–ª—å–Ω—ñ —Ç–µ–º–∏ –ø—Ä–æ–µ–∫—Ç—É
- **`plugins/`** ‚Äî –õ–æ–∫–∞–ª—å–Ω—ñ –ø–ª–∞–≥—ñ–Ω–∏ –ø—Ä–æ–µ–∫—Ç—É
- **`temp/`** ‚Äî –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∏–π SPA-–ø—Ä–æ–µ–∫—Ç (read-only, –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó)

### –ü–∞–∫–µ—Ç–∏ —è–¥—Ä–∞

| –ü–∞–∫–µ—Ç | Alias | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|-------|-------|-------------|
| `core/` | `@simplycms/core` | –ë—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫–∞, —Ö—É–∫–∏, —Ç–∏–ø–∏, Supabase –∫–ª—ñ—î–Ω—Ç–∏, –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ |
| `admin/` | `@simplycms/admin` | –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å (layouts, pages, components) |
| `ui/` | `@simplycms/ui` | –î–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–∞ (50+ shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤) |
| `plugin-system/` | `@simplycms/plugins` | HookRegistry, PluginLoader, PluginSlot |
| `theme-system/` | `@simplycms/themes` | ThemeRegistry, ThemeContext, ThemeResolver |
| `supabase/` | ‚Äî | –ú—ñ–≥—Ä–∞—Ü—ñ—ó –ë–î, Edge Functions, –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è |

### Rendering-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó

| Route Group | –°—Ç—Ä–∞—Ç–µ–≥—ñ—è | –û–ø–∏—Å |
|-------------|-----------|------|
| `(storefront)/` | SSR + ISR | –ü—É–±–ª—ñ—á–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏, SEO, revalidation |
| `(cms)/admin/` | Client-only | –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å, `'use client'` |
| `(protected)/` | Client-only | –ó–∞—Ö–∏—â–µ–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–ø—Ä–æ—Ñ—ñ–ª—å, –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è) |
| `auth/` | Client-only | –§–æ—Ä–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó |
| `api/` | Server | API routes |

## ‚úÖ ALWAYS
- –í–∏–±–∏—Ä–∞–π React Server Components –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º; –¥–æ–¥–∞–≤–∞–π `'use client'` –ª–∏—à–µ –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ (—Å—Ç–∞–Ω, –µ—Ñ–µ–∫—Ç–∏, –ø–æ–¥—ñ—ó).
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø–∞–∫–µ—Ç–∏ `@simplycms/*` –∑–∞–º—ñ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–∏—Ö –∫–æ–ø—ñ–π (UI, core, admin).
- SSR –¥–ª—è storefront-—Å—Ç–æ—Ä—ñ–Ω–æ–∫ (–∫–∞—Ç–∞–ª–æ–≥, —Ç–æ–≤–∞—Ä–∏, –≥–æ–ª–æ–≤–Ω–∞) ‚Äî SEO –∫—Ä–∏—Ç–∏—á–Ω–æ.
- Client-side –¥–ª—è –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ ‚Äî –≤—Å—è `(cms)/admin/` –ø—Ä–∞—Ü—é—î —è–∫ SPA.
- Cookie-based auth —á–µ—Ä–µ–∑ `@supabase/ssr` (–Ω–µ localStorage JWT).
- **–ò—Å–ø–æ–ª—å–∑—É–π MCP —Å–µ—Ä–≤–µ—Ä–∏** –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö API:
  - **context7:** Next.js, React, TanStack Query, Zod docs
  - **shadcn:** UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø–µ—Ä–µ–¥ –¥–æ–¥–∞–≤–∞–Ω–Ω—è–º
  - **supabase:** DB –º—ñ–≥—Ä–∞—Ü—ñ—ó, TypeScript types
- Middleware (`middleware.ts`) –¥–ª—è auth guards: `/admin` (admin role), `/profile` (auth).
- –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º: –ø—É–±–ª—ñ—á–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è —á–µ—Ä–µ–∑ `ThemeModule` (layouts, pages).
- –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥—ñ–Ω—ñ–≤: —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —á–µ—Ä–µ–∑ `HookRegistry` (25+ hook points).
- Git Subtree –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —è–¥—Ä–∞: `pnpm cms:push` / `pnpm cms:pull`.
- –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è CMS —á–µ—Ä–µ–∑ `simplycms.config.ts` (—Ç–µ–º–∞, –ø–ª–∞–≥—ñ–Ω–∏, Supabase, SEO).

## ‚ùå NEVER
- –ù–µ —Ä–æ–∑–º—ñ—â—É–π –±—ñ–∑–Ω–µ—Å-–ª–æ–≥—ñ–∫—É –≤ —Ç–µ–º–∞—Ö (—Ç–µ–º–∏ ‚Äî –ª–∏—à–µ –≤—ñ–∑—É–∞–ª—å–Ω–∞ —Å–∫–ª–∞–¥–æ–≤–∞).
- –ù–µ –æ–±–º–∏–Ω–∞–π —Å–∏—Å—Ç–µ–º—É —Ç–µ–º –¥–ª—è storefront-—Å—Ç–æ—Ä—ñ–Ω–æ–∫.
- –ù–µ —Ä–µ–¥–∞–≥—É–π —Ñ–∞–π–ª–∏ –≤ `temp/` ‚Äî —Ü–µ read-only —Ä–µ—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó.
- –ù–µ —Ö–∞—Ä–¥–∫–æ–¥—å Supabase URL/–∫–ª—é—á—ñ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –∑–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è.
- –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π –ø—Ä—è–º–∏–π `supabase-js` –±–µ–∑ `@simplycms/core` –æ–±–≥–æ—Ä—Ç–æ–∫ –≤ –∫–ª—ñ—î–Ω—Ç—Å—å–∫–æ–º—É –∫–æ–¥—ñ.
- **–ù–ï –¥–æ–¥–∞–≤–∞–π shadcn/ui –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –±–µ–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —á–µ—Ä–µ–∑ MCP** (search ‚Üí examples ‚Üí audit).
- **–ù–ï –ø—Ä–∏–ø—É—Å–∫–∞–π library APIs ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä—è–π —á–µ—Ä–µ–∑ MCP context7**.
- –ù–µ —Å—Ç–∞–≤–∞–π `'use client'` –≤ Server Components –±–µ–∑ –ø–æ—Ç—Ä–µ–±–∏.
- –ù–µ –≤–∏–Ω–æ—Å–∏ auth-–ª–æ–≥—ñ–∫—É –∑–∞ –º–µ–∂—ñ `middleware.ts` —Ç–∞ `auth/` route.
- –ù–µ —Å—Ç–≤–æ—Ä—é–π —Ñ–∞–π–ª–∏ > 150 —Ä—è–¥–∫—ñ–≤ –±–µ–∑ —Ä–æ–∑–±–∏—Ç—Ç—è.

## üìö –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–µ—Ç–∞–ª—ñ
- –ú—ñ–≥—Ä–∞—Ü—ñ–π–Ω–∏–π –ø–ª–∞–Ω: `BRD_SIMPLYCMS_NEXTJS.md`
- –°–∏—Å—Ç–µ–º–∞ —Ç–µ–º: BRD —Å–µ–∫—Ü—ñ—è 7 (ThemeModule, ThemeManifest, ThemePages)
- –°–∏—Å—Ç–µ–º–∞ –ø–ª–∞–≥—ñ–Ω—ñ–≤: BRD —Å–µ–∫—Ü—ñ—è 8 (PluginModule, HookRegistry, hook points)
- SSR-—Å—Ç—Ä–∞—Ç–µ–≥—ñ—è: BRD —Å–µ–∫—Ü—ñ—è 9 (ISR, revalidation, Server/Client Components)
- –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è: BRD —Å–µ–∫—Ü—ñ—è 10 (Supabase SSR, middleware)
- –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö: BRD —Å–µ–∫—Ü—ñ—è 11 (–º—ñ–≥—Ä–∞—Ü—ñ—ó —è–¥—Ä–∞ vs –ø—Ä–æ–µ–∫—Ç—É)
- –§–∞–π–ª–æ–≤–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è: BRD –î–æ–¥–∞—Ç–æ–∫ A (map temp/ ‚Üí packages/)

## üîÑ –†–æ–±–æ—á–∏–π —Ü–∏–∫–ª
1. –ü—Ä–æ—á–∏—Ç–∞–π –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π —Ä–æ–∑–¥—ñ–ª `BRD_SIMPLYCMS_NEXTJS.md`, —è–∫—â–æ –ø—Ä–∞—Ü—é—î—à –Ω–∞–¥ –Ω–æ–≤–æ—é —Ñ—ñ—á–µ—é.
2. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π MCP –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö API —Ç–∞ best practices.
3. –ü–µ—Ä–µ–≤—ñ—Ä, —á–∏ —ñ—Å–Ω—É—î —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤ `.github/instructions` –¥–ª—è —Ç–≤–æ—î—ó —Å—Ñ–µ—Ä–∏.
4. –Ø–∫—â–æ –º—ñ–≥—Ä—É—î—à –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ‚Äî –∑–Ω–∞–π–¥–∏ –æ—Ä–∏–≥—ñ–Ω–∞–ª —É `temp/src/` —Ç–∞ –∞–¥–∞–ø—Ç—É–π.
5. –õ–∏—à–µ –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ –¥–æ–¥–∞–≤–∞–π –∞–±–æ –∑–º—ñ–Ω—é–π –∫–æ–¥.
